<ui:FluentWindow x:Class="GrammarAssistant.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:GrammarAssistant"
        Title="Grammar Assistant" Height="750" Width="1300"
        MinHeight="650" MinWidth="1000"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        WindowCornerPreference="Round"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- Custom Colors -->
        <SolidColorBrush x:Key="AccentColor" Color="#00C853"/>
        
        <!-- Null to Visibility Converter -->
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0" Title="Grammar Assistant" Height="46">
            <ui:TitleBar.Header>
                <StackPanel Orientation="Horizontal" Margin="12,0,0,0">
                    <TextBlock Text="âœ“" FontSize="20" FontWeight="Bold" 
                              Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <ui:Button Content="Stats" ToolTip="Statistics" 
                              Click="OnShowStatsClick" Appearance="Transparent" 
                              Margin="8,0,4,0" Padding="12,6"/>
                    <ui:Button Content="History" ToolTip="History" 
                              Click="OnShowHistoryClick" Appearance="Transparent" 
                              Margin="4,0" Padding="12,6"/>
                    <ui:Button x:Name="DarkModeButton" Content="Dark" ToolTip="Toggle Theme" 
                              Click="OnToggleDarkModeClick" Appearance="Transparent" 
                              Margin="4,0" Padding="12,6"/>
                </StackPanel>
            </ui:TitleBar.Header>
        </ui:TitleBar>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="400"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="*" MinWidth="400"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Left Panel Header with All Buttons -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="Your Text" FontSize="22" FontWeight="SemiBold" 
                              VerticalAlignment="Center"/>
                    
                    <ItemsControl Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" HorizontalAlignment="Right"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ui:Button Content="New" ToolTip="New (Ctrl+N)" 
                                  Click="OnNewClick" Appearance="Secondary" 
                                  Margin="4,2" Padding="12,8" Height="36"/>
                        <ui:Button Content="Open" ToolTip="Open (Ctrl+O)" 
                                  Click="OnOpenClick" Appearance="Secondary" 
                                  Margin="4,2" Padding="12,8" Height="36"/>
                        <ui:Button Content="Save" ToolTip="Save (Ctrl+S)" 
                                  Click="OnSaveClick" Appearance="Secondary" 
                                  Margin="4,2" Padding="12,8" Height="36"/>
                        <ui:Button Content="Copy" ToolTip="Copy Corrected Text" 
                                  x:Name="CopyCorrectedButton"
                                  Click="OnCopyCorrectedClick" IsEnabled="False"
                                  Appearance="Secondary" 
                                  Margin="4,2" Padding="12,8" Height="36"/>
                        <ui:Button Content="â†¶" ToolTip="Undo (Ctrl+Z)" 
                                  x:Name="UndoButton"
                                  Click="OnUndoClick" IsEnabled="False"
                                  Appearance="Secondary" 
                                  Margin="4,2" Padding="12,8" Width="40" Height="36"/>
                        <ui:Button Content="â†·" ToolTip="Redo (Ctrl+Y)" 
                                  x:Name="RedoButton"
                                  Click="OnRedoClick" IsEnabled="False"
                                  Appearance="Secondary" 
                                  Margin="4,2" Padding="12,8" Width="40" Height="36"/>
                    </ItemsControl>
                </Grid>

                <!-- Left Panel Content Card -->
                <ui:Card Grid.Row="1" Padding="24" VerticalAlignment="Stretch">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Text Input with RichTextBox and Tooltip Overlay -->
                        <Grid Grid.Row="0" Margin="0,0,0,20">
                            <Border BorderBrush="{DynamicResource ControlElevationBorderBrush}" 
                                   BorderThickness="1" CornerRadius="4">
                                <RichTextBox x:Name="InputText" 
                                            AcceptsReturn="True" 
                                            VerticalScrollBarVisibility="Auto"
                                            MinHeight="250"
                                            Padding="12"
                                            FontSize="14"
                                            BorderThickness="0"
                                            TextChanged="OnInputTextChanged"
                                            MouseMove="OnInputTextMouseMove"
                                            VerticalAlignment="Stretch">
                                    <RichTextBox.Resources>
                                        <Style TargetType="Paragraph">
                                            <Setter Property="Margin" Value="0"/>
                                        </Style>
                                    </RichTextBox.Resources>
                                </RichTextBox>
                            </Border>
                            
                            <!-- Tooltip Popup - using Popup for proper rendering -->
                            <Popup x:Name="TooltipPopup" 
                                   AllowsTransparency="True"
                                   Placement="Relative"
                                   PlacementTarget="{Binding ElementName=InputText}"
                                   StaysOpen="True"
                                   IsOpen="False">
                                <Border Background="#FFFFFF" 
                                       BorderBrush="#E53935" 
                                       BorderThickness="2" 
                                       CornerRadius="6" 
                                       Padding="12"
                                       MaxWidth="350"
                                       Opacity="1.0"
                                       MouseEnter="OnTooltipBorderMouseEnter"
                                       MouseLeave="OnTooltipBorderMouseLeave">
                                    <Border.Effect>
                                        <DropShadowEffect Color="Black" Opacity="0.5" BlurRadius="15" ShadowDepth="4"/>
                                    </Border.Effect>
                                    <StackPanel>
                                        <TextBlock x:Name="TooltipTitle" 
                                                  FontWeight="Bold" 
                                                  FontSize="13"
                                                  Foreground="#E53935"
                                                  TextWrapping="Wrap"
                                                  Opacity="1.0"/>
                                        <TextBlock x:Name="TooltipText" 
                                                  FontSize="12"
                                                  Foreground="#333333"
                                                  TextWrapping="Wrap"
                                                  Margin="0,8,0,0"
                                                  Opacity="1.0"/>
                                        <StackPanel x:Name="TooltipButtons" 
                                                   Orientation="Horizontal" 
                                                   Margin="0,12,0,0"
                                                   HorizontalAlignment="Right">
                                            <Button x:Name="ApplySuggestionButton"
                                                   Content="âœ“ Apply"
                                                   Background="#4CAF50"
                                                   Foreground="White"
                                                   BorderThickness="0"
                                                   Padding="12,6"
                                                   Margin="0,0,8,0"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"
                                                   Cursor="Hand"
                                                   Click="OnApplySuggestionClick"/>
                                            <Button x:Name="IgnoreSuggestionButton"
                                                   Content="âœ• Ignore"
                                                   Background="#757575"
                                                   Foreground="White"
                                                   BorderThickness="0"
                                                   Padding="12,6"
                                                   FontSize="11"
                                                   FontWeight="SemiBold"
                                                   Cursor="Hand"
                                                   Click="OnIgnoreSuggestionClick"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </Popup>
                        </Grid>

                        <!-- Stats -->
                        <ui:CardExpander Grid.Row="1" Header="Statistics" Margin="0,0,0,20" IsExpanded="True">
                            <StackPanel Margin="12,12,12,8">
                                <TextBlock x:Name="ReadabilityText" FontSize="13" 
                                          Text="Words: 0 | Sentences: 0 | Readability: N/A"
                                          TextWrapping="Wrap" Margin="0,0,0,12"/>
                                <ui:ToggleSwitch x:Name="RealtimeCheckBox" Content="Real-time AI checking" 
                                               Checked="OnRealtimeCheckChanged" 
                                               Unchecked="OnRealtimeCheckChanged"/>
                            </StackPanel>
                        </ui:CardExpander>

                        <!-- Action Buttons - Responsive Wrap -->
                        <ItemsControl Grid.Row="2" HorizontalAlignment="Center">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ui:Button x:Name="CheckTextButton"
                                      Content="âš¡ Quick Check"
                                      Appearance="Primary" Height="48" Margin="4,4" 
                                      Click="OnCheckTextClick" FontSize="14" Padding="16,12"/>

                            <ui:Button x:Name="CheckWithAiButton"
                                      Content="ðŸ§  AI Check"
                                      Appearance="Primary" Height="48" Margin="4,4" 
                                      Click="OnCheckWithAiClick" FontSize="14" Padding="16,12"/>

                            <ui:Button x:Name="RewriteButton"
                                      Content="âœ¨ AI Rewrite"
                                      Appearance="Info" Height="48" Margin="4,4" 
                                      Click="OnRewriteClick" FontSize="14" Padding="16,12"/>

                            <ui:Button x:Name="ApplyCorrectionsButton"
                                      Content="âœ“ Apply All"
                                      Appearance="Success" Height="48" Margin="4,4" 
                                      Click="OnApplyCorrectionsClick" IsEnabled="False" FontSize="14" Padding="16,12"/>

                            <ui:Button x:Name="CheckClipboardButton"
                                      Content="ðŸ“‹ Clipboard"
                                      Appearance="Secondary" Height="48" Margin="4,4"
                                      Click="OnCheckClipboardClick" FontSize="14" Padding="16,12"/>
                        </ItemsControl>
                    </Grid>
                </ui:Card>
            </Grid>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="12" HorizontalAlignment="Stretch" 
                         Background="Transparent" ShowsPreview="True"/>

            <!-- Right Panel -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Right Panel Header -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <TextBlock Text="ðŸ’¡ Suggestions" FontSize="22" FontWeight="SemiBold" 
                              VerticalAlignment="Center" HorizontalAlignment="Left"/>
                </Grid>

                <!-- Right Panel Content Card -->
                <ui:Card Grid.Row="1" Padding="0" VerticalAlignment="Stretch" VerticalContentAlignment="Top">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
                        <ItemsControl x:Name="SuggestionsList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <ui:Card Margin="0,0,0,12" Padding="16">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding Message}" FontWeight="SemiBold" 
                                                          TextWrapping="Wrap" FontSize="14"/>
                                                <TextBlock Text="{Binding SuggestionText}" FontStyle="Italic" 
                                                          Opacity="0.8" TextWrapping="Wrap" 
                                                          Margin="0,8,0,0" FontSize="13"/>
                                            </StackPanel>
                                            <Button Grid.Column="1" Content="Apply" 
                                                   VerticalAlignment="Top"
                                                   Margin="12,0,0,0"
                                                   Padding="12,6"
                                                   Background="#4CAF50"
                                                   Foreground="White"
                                                   BorderThickness="0"
                                                   FontSize="12"
                                                   Cursor="Hand"
                                                   Visibility="{Binding ReplacementText, Converter={StaticResource NullToVisibilityConverter}}"
                                                   Click="OnSuggestionApplyClick"
                                                   Tag="{Binding}"/>
                                        </Grid>
                                    </ui:Card>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </ui:Card>

                <!-- Rewrite Preview Panel -->
                <ui:Card x:Name="RewritePanel" Grid.Row="2" Padding="16" Margin="0,16,0,0" Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="âœ¨ AI Rewrite Preview" FontSize="16" FontWeight="SemiBold" 
                                      VerticalAlignment="Center"/>
                            <ui:Button Content="âœ•" Appearance="Transparent" Padding="8,4" 
                                      Margin="8,0,0,0" Click="OnCloseRewritePanel" 
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <!-- Style Selection -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="Style:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="RewriteStyleCombo" Width="150" SelectedIndex="0">
                                <ComboBoxItem Content="Professional"/>
                                <ComboBoxItem Content="Casual"/>
                                <ComboBoxItem Content="Formal"/>
                                <ComboBoxItem Content="Concise"/>
                                <ComboBoxItem Content="Elaborate"/>
                                <ComboBoxItem Content="Friendly"/>
                                <ComboBoxItem Content="Academic"/>
                            </ComboBox>
                            <ui:Button x:Name="RegenerateButton" Content="ðŸ”„ Regenerate" 
                                      Appearance="Secondary" Margin="8,0,0,0" Padding="12,6"
                                      Click="OnRegenerateRewrite"/>
                        </StackPanel>
                        
                        <!-- Preview Text -->
                        <Border Grid.Row="2" BorderBrush="{DynamicResource ControlElevationBorderBrush}" 
                               BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,12"
                               MaxHeight="200">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <TextBlock x:Name="RewritePreviewText" TextWrapping="Wrap" FontSize="13"/>
                            </ScrollViewer>
                        </Border>
                        
                        <!-- Action Buttons -->
                        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
                            <ui:Button Content="ðŸ“‹ Copy" Appearance="Secondary" Padding="12,8" 
                                      Margin="0,0,8,0" Click="OnCopyRewrite"/>
                            <ui:Button x:Name="ApplyRewriteButton" Content="âœ“ Apply Rewrite" 
                                      Appearance="Success" Padding="12,8" Click="OnApplyRewrite"/>
                        </StackPanel>
                    </Grid>
                </ui:Card>
            </Grid>
        </Grid>
    </Grid>
</ui:FluentWindow>
